document.addEventListener("DOMContentLoaded",place);function place(){for(var a=document.querySelectorAll("img[data-place]"),b=function(){var b=a[c],e=b.cloneNode(),f=e.width,g=e.height,i=document.createElement("div");i.style.display="inline-block",i.style.width=f+"px",i.style.height=g+"px",i.style.position="relative";var j=document.createElement("canvas");j.style.display="inline-block",j.style.position="absolute",j.style.zIndex=99,j.style.transition="opacity 0.7s",i.appendChild(j),i.appendChild(e),b.parentNode.replaceChild(i,b),d=new XMLHttpRequest;var k=b.dataset.place.replace(/\.[^/.]+$/,".tri");d.open("GET",k,!0),d.responseType="arraybuffer",d.onreadystatechange=function(a){var b=a.currentTarget.response;if(b){e.src=e.dataset.place,e.onload=function(){j.style.opacity="0"};var c=new DataView(b),d=c.getUint16(0,!0),h=c.getUint16(2,!0);j.width=d,j.height=h,f=f||g*(d/h),g=g||f*(h/d),f||g||(f=d,g=h),i.style.width=f+"px",i.style.height=g+"px",j.style.width=f+"px",j.style.height=g+"px",render(parseData(c),j)}},d.send()},c=0;c<a.length;c++){var d;b()}}function parseData(a){for(var b=Math.floor,c=[{triangle:[[a.getUint16(5,!0),a.getUint16(7,!0)],[a.getUint16(9,!0),a.getUint16(11,!0)],[a.getUint16(13,!0),a.getUint16(15,!0)]],color:[a.getUint8(17,!0),a.getUint8(18,!0),a.getUint8(19,!0)],remaining:a.getUint8(4,!0)}],d=0,e=20;e<a.byteLength;e+=8){var f=a.getUint8(e,!0)%3,g=c[d].triangle;for(c.push({triangle:[g[f],g[(f+1)%3],[a.getUint16(e+1,!0),a.getUint16(e+3,!0)]].sort(function(c,a){return c[1]==a[1]?c[0]-a[0]:c[1]-a[1]}),color:[a.getUint8(e+5,!0),a.getUint8(e+6,!0),a.getUint8(e+7,!0)],remaining:b(a.getUint8(e,!0)/3)}),c[d].remaining--;c[d]&&0==c[d].remaining;)d++}return c}function render(a,b){var c=b.getContext("2d",{alpha:!1}),d=window.devicePixelRatio;1<d&&(b.width*=d,b.height*=d,c.scale(d,d)),c.clearRect(0,0,b.width,b.height);for(var e=0;e<a.length;e++){var f=a[e].triangle,g=a[e].color,h="rgb(".concat(g[0],", ").concat(g[1],", ").concat(g[2],")");c.fillStyle=h,c.strokeStyle=h,c.lineWidth=.5,c.beginPath(),c.moveTo(f[0][0],f[0][1]),c.lineTo(f[1][0],f[1][1]),c.lineTo(f[2][0],f[2][1]),c.closePath(),c.fill(),c.stroke()}}